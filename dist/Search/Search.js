var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _extends3=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _objectSpread3=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _propTypes=_interopRequireDefault(require("prop-types"));var _react=_interopRequireDefault(require("react"));var _reactNative=require("react-native");var _index=require("../index");var _Theme=_interopRequireDefault(require("../Theme"));var _jsxFileName="/Users/nacho/projects/el-native/src/Search/Search.js";var theme=_Theme.default.getTheme();var styles=theme.search;var propTypes={handleSearch:_propTypes.default.func,keys:_propTypes.default.array,dataList:_propTypes.default.array.isRequired,filters:_propTypes.default.object,placeholder:_propTypes.default.string,inputStyles:_propTypes.default.object,cancelIconStyles:_propTypes.default.object,labelStyle:_propTypes.default.object,labelStyleActive:_propTypes.default.object,labelTextStyle:_propTypes.default.object,labelTextStyleActive:_propTypes.default.object,placeholderTextColor:_propTypes.default.string,filtersLabels:_propTypes.default.object};var defaultProps={handleSearch:function handleSearch(){return null;},keys:[],filters:{},placeholder:'Search',inputStyles:{},cancelIconStyles:{},labelStyle:{},labelStyleActive:{},labelTextStyle:{},labelTextStyleActive:{},placeholderTextColor:'#999',filtersLabels:{}};var Search=function(_React$Component){(0,_inherits2.default)(Search,_React$Component);function Search(props){var _this;(0,_classCallCheck2.default)(this,Search);_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(Search).call(this,props));_this.onEndEditing=function(){_this.handleSearch();};_this.handleChange=function(value){_this.setState({value:value});};_this.searchByFilters=function(list,filters,selectedFilters){var selectedFiltersName=Object.keys(selectedFilters).filter(function(k){return selectedFilters[k];});if(!selectedFiltersName.length){return list;}var findValueInMany=function findValueInMany(values,comparator){if(values.indexOf(',')===-1){return values.replace(/ /g,'')===comparator.replace(/ /g,'');}var names=values.split(',');return names.indexOf(comparator.replace(/ /g,''))!==-1||names.indexOf(" "+comparator)!==-1||names.indexOf(comparator+" ")!==-1;};var filteredList=list.filter(function(e){return selectedFiltersName.every(function(currentFilterName){return filters[currentFilterName].some(function(filterObject){return filterObject.value&&findValueInMany(e[currentFilterName],filterObject.name);});});});return filteredList;};_this.searchByKeys=function(list,keys,patt){return list.filter(function(listElement){return keys.some(function(k){return patt.test(listElement[k]);});});};_this.search=function(list,value,keys){var regValues=value.split(' ').join('|');var patt=new RegExp(regValues,'i');var _this$state=_this.state,filters=_this$state.filters,selectedFilters=_this$state.selectedFilters;var result=list;result=_this.searchByFilters(list,filters,selectedFilters);if(value&&keys){return _this.searchByKeys(result,keys,patt);}if(value===''){return result;}return result.filter(function(e){return patt.test(e);});};_this.handleSearch=function(){var value=_this.state.value;var result=_this.search(_this.props.dataList,value,_this.props.keys);_this.props.handleSearch(result);};_this.cleanInput=function(){_this.setState({value:''},function(){return _this.handleSearch();});};_this.handleOpenFilter=function(f){_this.setState({modalVisible:true,selectedFilter:f});};_this.handleApplyFilters=function(filters){var selected=filters.find(function(e){return e.value;});_this.setState(function(prevState){return{modalVisible:false,selectedFilters:(0,_objectSpread3.default)({},prevState.selectedFilters,(0,_defineProperty2.default)({},prevState.selectedFilter,!!selected))};},function(){_this.handleSearch();});};_this.renderFilterLabel=function(f,i){var defaultStyles=(0,_objectSpread3.default)({},styles.label,_this.props.labelStyle);var onStyles=(0,_objectSpread3.default)({},styles.labelOn,_this.props.labelStyleActive);var bgStyles=_this.state.selectedFilters[f]?(0,_objectSpread3.default)({},defaultStyles,onStyles):defaultStyles;var defaultTextStyle=(0,_objectSpread3.default)({},styles.labelText,_this.props.labelTextStyle);var onTextStyles=(0,_objectSpread3.default)({},styles.labelTextOn,_this.props.labelTextStyleActive);var textStyles=_this.state.selectedFilters[f]?(0,_objectSpread3.default)({},defaultTextStyle,onTextStyles):defaultTextStyle;return _react.default.createElement(_index.Button,{onPress:function onPress(){return _this.handleOpenFilter(f);},key:i,backgroundStyles:bgStyles,textStyles:textStyles,outline:true,text:_this.props.filtersLabels[f].label,__source:{fileName:_jsxFileName,lineNumber:155}});};_this.renderModal=function(visible,filters){return _react.default.createElement(_index.FilterModal,{modalVisible:visible,title:_this.props.filtersLabels[_this.state.selectedFilter].modalTitle,filters:filters,applyFilters:_this.handleApplyFilters,__source:{fileName:_jsxFileName,lineNumber:167}});};var _selectedFilters={};Object.keys(_this.props.filters).forEach(function(e){return(0,_extends3.default)(_selectedFilters,(0,_defineProperty2.default)({},e,false));});_this.state={value:'',modalVisible:false,filters:_this.props.filters,selectedFilters:_selectedFilters};return _this;}(0,_createClass2.default)(Search,[{key:"render",value:function render(){var _this2=this;return _react.default.createElement(_reactNative.View,{__source:{fileName:_jsxFileName,lineNumber:177}},_react.default.createElement(_reactNative.View,{style:styles.wrapper,__source:{fileName:_jsxFileName,lineNumber:178}},_react.default.createElement(_index.Input,{placeholder:this.props.placeholder,type:"squared",onChangeText:function onChangeText(text){return _this2.handleChange(text);},value:this.state.value,style:(0,_objectSpread3.default)({},styles.input,this.props.inputStyles),onEndEditing:this.onEndEditing,returnKeyType:"search",errorLabel:false,placeholderTextColor:this.props.placeholderTextColor,__source:{fileName:_jsxFileName,lineNumber:179}}),this.state.value!==''&&_react.default.createElement(_reactNative.View,{style:styles.cancelButtonWrapper,__source:{fileName:_jsxFileName,lineNumber:191}},_react.default.createElement(_index.Button,{onPress:this.cleanInput,icon:"ios-close",transparent:true,textStyles:(0,_objectSpread3.default)({},styles.cancelButtonIcon,this.props.cancelIconStyles),backgroundStyles:styles.cancelButton,__source:{fileName:_jsxFileName,lineNumber:192}}))),_react.default.createElement(_reactNative.View,{style:styles.wrapper,__source:{fileName:_jsxFileName,lineNumber:202}},Object.keys(this.state.filters).map(function(e,i){return _this2.renderFilterLabel(e,i);})),this.state.selectedFilter&&this.renderModal(this.state.modalVisible,this.state.filters[this.state.selectedFilter]));}}]);return Search;}(_react.default.Component);Search.propTypes=propTypes;Search.defaultProps=defaultProps;var _default=Search;exports.default=_default;